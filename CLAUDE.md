# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

AstralisMotion Rive MCP Monorepo is an NX-based scaffold that unifies Rive animation integration with an MCP (Model Context Protocol) orchestrator server. The system bridges Rive Editor assets with framework-specific wrappers through specialized AI agents.

## Core Architecture

The system follows a three-layer architecture:

1. **Rive Editor & Assets**: Designers author `.riv` files, libraries, and components
2. **Rive MCP Orchestrator**: Node/TS MCP server that indexes assets, exposes runtime surfaces, generates wrappers, and composes scenes
3. **Consumers**: Next.js/React apps, Stencil web components, Vue apps, and game clients

**Critical Design Principle**: Integration and logic live OUTSIDE the `.riv` files.

## Monorepo Structure

- `apps/`: Applications (web, demo, dashboard, cli)
- `libs/`: Shared libraries
  - `rive-components/`: Generated wrapper components
  - `motion-scenes/`: Composed multi-Rive scenes
  - `motion-specs/`: Motion & creation specs (JSON)
  - `rive-manifests/`: Indexed manifests for Rive assets
  - `motion-utils/`: Shared runtime utilities
  - `design-tokens/`: Brand tokens
  - `motion-qa/`: QA rules & validators
  - `types/`: Shared TypeScript types
- `packages/`: Standalone packages
  - `mcp-server/`: Rive MCP Orchestrator server
  - `mcp-agents/`: Specialized agents
  - `telemetry-service/`: Metrics API
  - `scene-composer/`: Scene composition utilities
  - `rive-synth/`: Future procedural animation generator
- `tools/`: Generators, scripts, and CI/CD configs

## MCP Tools

The MCP server (`packages/mcp-server/`) exposes these tools:

- `list_libraries`: Discover available Rive libraries
- `list_components`: List Rive components
- `get_component_detail`: Get detailed component information
- `get_runtime_surface`: Extract runtime surfaces (inputs, events, state machines)
- `generate_wrapper`: Generate framework-specific wrappers
- `compose_scene`: Compose multi-Rive scenes

## Specialized Agents

Five agent types coordinate development (configs in `packages/mcp-agents/agents/`):

1. **Motion Spec Agent**: Converts UX/product descriptions into CreationSpec JSON, writes to `libs/motion-specs/`
2. **Wrapper Generator Agent**: Uses runtime surfaces to generate wrappers, writes to `libs/rive-components/`
3. **Scene Composer Agent**: Builds scenes from components, writes to `libs/motion-scenes/`
4. **Telemetry & Performance Agent**: Reads metrics, suggests optimizations
5. **QA/Compliance Agent**: Validates wrappers/scenes against runtime surfaces and rules

## Motion Specs Format

Motion specs (JSON files in `libs/motion-specs/`) define animation experiences with:

- `id`, `name`, `purpose`: Identity and intent
- `inputs`: Array of runtime inputs (name, type, description)
- `events`: Array of emitted events
- `visualGuidelines`: Brand, palette, design notes
- `motionGuidelines`: Duration, easing, style keywords

See `libs/motion-specs/jackpot-win-spec.json` for reference.

## Runtime Surface Interface

The `RuntimeSurface` type (`libs/types/index.d.ts`) describes component capabilities:

- `componentId`: Unique identifier
- `stateMachines`: Array with inputs (bool/number/string) and events
- `dataBindings`: Optional array for dynamic data (array/object/image/text)
- `recommendedFrameworks`: Suggested target frameworks
- `runtimeVersion`: Rive runtime version

## Development Commands

**Build**:
```bash
# Placeholder - will be hooked to NX
npm run build
```

**Test**:
```bash
# Placeholder - will be hooked to NX
npm test
```

**Dev Server**:
```bash
# Placeholder - will be hooked to NX serve demo
npm run dev
```

Note: This is a scaffold repository. NX workspace configuration is not yet implemented. Commands above are placeholders.

## TypeScript Configuration

- Target: ES2020
- Module: ESNext
- Strict mode enabled
- Base path: `.` (project root)
- JSON module resolution enabled

## Development Workflow

1. **Asset Changes**: Designers update `.riv` files in Rive Editor
2. **Indexing**: MCP server discovers and indexes new/updated assets
3. **Spec Creation**: Motion Spec Agent creates CreationSpec JSON from requirements
4. **Wrapper Generation**: Wrapper Generator Agent produces framework-specific components
5. **Scene Composition**: Scene Composer Agent orchestrates multi-Rive experiences
6. **QA Validation**: QA Agent validates against runtime surfaces and rules
7. **Telemetry**: Telemetry Agent monitors performance and suggests optimizations

## Key Constraints

- Integration logic must remain external to `.riv` files
- All wrappers are autogenerated from runtime surfaces
- Motion specs serve as source of truth for animation requirements
- Agents operate independently but coordinate through MCP tools
